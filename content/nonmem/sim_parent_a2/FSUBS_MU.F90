      SUBROUTINE MUMODEL2(THETA,MU_,ICALL,IDEF,NEWIND,&
      EVTREC,DATREC,IREV,NVNT,INDXS,F,G,H,IRGG,GG,NETAS)
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMPRD_REAL,ONLY: ETA,EPS
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE,NOFIRSTDERCODE
      USE NMPRD_REAL, ONLY: DV_LOQ,CDF_L
      USE NMPRD_INT, ONLY: IQUIT
      USE NMBAYES_REAL, ONLY: LDF
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)
      REAL(KIND=DPSIZE)   :: MU_(*)
      INTEGER NEWIND
      REAL(KIND=DPSIZE) :: EVTREC
      SAVE
      INTEGER(KIND=ISIZE) :: FIRSTEM
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,GPKD+1,*)
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN
      CALL ASSOCNMPRD4
      IDEF(   1,0001)=  -9
      IDEF(   1,0002)=  -1
      IDEF(   1,0003)=   0
      IDEF(   1,0004)=   0
      IDEF(   2,0001)=   4
      IDEF(   2,0003)=   0
      IDEF(   2,0004)=   0
      IDEF(   3,0002)=   5
      IDEF(   3,0003)=   6
      CALL GETETA(ETA)
      IF (IQUIT == 1) RETURN
      RETURN
      ENDIF
      IF (NEWIND /= 2) THEN
      IF (ICALL == 4) THEN
      CALL SIMETA(ETA)
      ELSE
      CALL GETETA(ETA)
      ENDIF
      IF (IQUIT == 1) RETURN
      ENDIF
 !  level            0
      UVOL=EVTREC(NVNT,004)
      K12=THETA(001)
      KA=K12
      MU_1=DLOG(THETA(002))
      MU_(001)=MU_1
      B000001=MU_1+ETA(001)
      B000002=DEXP(B000001)
      V2=B000002
      MU_2=DLOG(THETA(003))
      MU_(002)=MU_2
       RETURN
      B000003=MU_2+ETA(002)
      B000004=DEXP(B000003)
      CLP=B000004
      CLB=THETA(004)
      K23=CLP/V2+CLB/V2
      K=K23
      B000017=CLP+CLB
      F0=CLP/B000017
      S2=V2
      S3=UVOL
      IF (FIRSTEM == 1) THEN
      B000005=1.D0/V2
!                      A000041 = DERIVATIVE OF K23 W.R.T. ETA(002)
      A000041=B000005*B000004
      B000006=-CLP/V2/V2
!                      A000042 = DERIVATIVE OF K23 W.R.T. ETA(001)
      A000042=B000006*B000002
      B000007=-CLB/V2/V2
!                      A000043 = DERIVATIVE OF K23 W.R.T. ETA(001)
      A000043=B000007*B000002+A000042
!                      A000064 = DERIVATIVE OF K W.R.T. ETA(001)
      A000064=A000043
!                      A000065 = DERIVATIVE OF K W.R.T. ETA(002)
      A000065=A000041
      B000018=1.D0/B000017
!                      A000070 = DERIVATIVE OF F0 W.R.T. ETA(002)
      A000070=B000018*B000004
      B000019=-CLP/B000017/B000017
!                      A000071 = DERIVATIVE OF F0 W.R.T. ETA(002)
      A000071=B000019*B000004+A000070
!                      A000085 = DERIVATIVE OF S2 W.R.T. ETA(001)
      A000085=B000002
      GG(0001,1,1)=K
      GG(0001,0002,1)=A000064
      GG(0001,0003,1)=A000065
      GG(0003,1,1)=KA
      GG(0005,1,1)=S2
      GG(0005,0002,1)=A000085
      GG(0006,1,1)=S3
      GG(0004,1,1)=F0
      GG(0004,0003,1)=A000071
      ELSE
      GG(0001,1,1)=K
      GG(0003,1,1)=KA
      GG(0005,1,1)=S2
      GG(0006,1,1)=S3
      GG(0004,1,1)=F0
      ENDIF
      IF (MSEC == 1) THEN
      B000011=-1.D0/V2/V2
!                      A000046 = DERIVATIVE OF B000005 W.R.T. ETA(001)
      A000046=B000011*B000002
!                      A000047 = DERIVATIVE OF A000041 W.R.T. ETA(002)
      A000047=B000005*B000004
      B000012=-1.D0/V2/V2
!                      A000048 = DERIVATIVE OF B000006 W.R.T. ETA(002)
      A000048=B000012*B000004
      B000013=CLP/V2/V2/V2
!                      A000049 = DERIVATIVE OF B000006 W.R.T. ETA(001)
      A000049=B000013*B000002
      B000014=CLP/V2/V2/V2
!                      A000050 = DERIVATIVE OF B000006 W.R.T. ETA(001)
      A000050=B000014*B000002+A000049
!                      A000051 = DERIVATIVE OF A000042 W.R.T. ETA(001)
      A000051=B000002*A000050
!                      A000052 = DERIVATIVE OF A000042 W.R.T. ETA(002)
      A000052=B000002*A000048
!                      A000053 = DERIVATIVE OF A000042 W.R.T. ETA(001)
      A000053=B000006*B000002+A000051
      B000015=CLB/V2/V2/V2
!                      A000054 = DERIVATIVE OF B000007 W.R.T. ETA(001)
      A000054=B000015*B000002
      B000016=CLB/V2/V2/V2
!                      A000055 = DERIVATIVE OF B000007 W.R.T. ETA(001)
      A000055=B000016*B000002+A000054
!                      A000056 = DERIVATIVE OF A000043 W.R.T. ETA(001)
      A000056=B000002*A000055
!                      A000057 = DERIVATIVE OF A000043 W.R.T. ETA(001)
      A000057=B000007*B000002+A000056
!                      A000058 = DERIVATIVE OF A000043 W.R.T. ETA(001)
      A000058=A000053+A000057
!                      A000066 = DERIVATIVE OF A000064 W.R.T. ETA(002)
      A000066=A000052
!                      A000067 = DERIVATIVE OF A000064 W.R.T. ETA(001)
      A000067=A000058
!                      A000068 = DERIVATIVE OF A000065 W.R.T. ETA(002)
      A000068=A000047
      B000021=-1.D0/B000017/B000017
!                      A000074 = DERIVATIVE OF B000018 W.R.T. ETA(002)
      A000074=B000021*B000004
!                      A000075 = DERIVATIVE OF A000070 W.R.T. ETA(002)
      A000075=B000004*A000074
!                      A000076 = DERIVATIVE OF A000070 W.R.T. ETA(002)
      A000076=B000018*B000004+A000075
      B000022=-1.D0/B000017/B000017
!                      A000077 = DERIVATIVE OF B000019 W.R.T. ETA(002)
      A000077=B000022*B000004
      B000023=CLP/B000017/B000017/B000017
!                      A000078 = DERIVATIVE OF B000019 W.R.T. ETA(002)
      A000078=B000023*B000004+A000077
      B000024=CLP/B000017/B000017/B000017
!                      A000079 = DERIVATIVE OF B000019 W.R.T. ETA(002)
      A000079=B000024*B000004+A000078
!                      A000080 = DERIVATIVE OF A000071 W.R.T. ETA(002)
      A000080=B000004*A000079
!                      A000081 = DERIVATIVE OF A000071 W.R.T. ETA(002)
      A000081=B000019*B000004+A000080
!                      A000082 = DERIVATIVE OF A000071 W.R.T. ETA(002)
      A000082=A000076+A000081
!                      A000086 = DERIVATIVE OF A000085 W.R.T. ETA(001)
      A000086=B000002
      GG(0001,0002,0002)=A000067
      GG(0001,0003,0002)=A000066
      GG(0001,0003,0003)=A000068
      GG(0005,0002,0002)=A000086
      GG(0004,0003,0003)=A000082
      ENDIF
      RETURN
      END
